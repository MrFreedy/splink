<div class="p-8 grid grid-cols-1 lg:grid-cols-2 gap-8 w-7xl mx-auto items-stretch">
    <!-- R√©partition mensuelle -->
    <div class="bg-[var(--color-card)] rounded-xl p-4 shadow flex flex-col h-full">
        <div class="flex-grow flex items-bottom justify-center">
          <app-chart-item></app-chart-item>
        </div>
    </div>

    <div class="grid grid-rows-2 h-full gap-8">
      <!-- Qui doit quoi -->
      <div class="bg-[var(--color-card)] rounded-xl p-4 shadow flex flex-col h-fit max-h-[228px] overflow-hidden">
          <h2 class="text-3xl font-bold text-[var(--color-green-secondary)] mb-4 text-center">Qui doit quoi ?</h2>
          <div class="space-y-2 overflow-y-auto flex-1">
            <ng-container *ngIf="dettes.length > 0 || avoirs.length > 0; else noActivity">
                <ng-container *ngIf="dettes.length > 0">
                  <ng-container *ngFor="let dette of dettes">
                    <app-dettes-item
                      [amount]="dette.dueAmount"
                      [user]="dette.paidBy.username">
                    </app-dettes-item>
                  </ng-container>
                </ng-container>
                <ng-container *ngIf="avoirs.length > 0">
                  <ng-container *ngFor="let avoir of avoirs">
                    <app-avoirs-item
                      [amount]="avoir.amountDue"
                      [user]="avoir.owedBy.username">
                    </app-avoirs-item>
                  </ng-container>
                </ng-container>
              </ng-container>
              
              <ng-template #noActivity>
                <p class="text-center text-[var(--color-green-secondary)] font-bold text-xl mt-4">
                  Vous ne devez rien et on ne vous doit rien üôå
                </p>
              </ng-template>
          </div>
      </div>

        <!-- G√©rer les d√©penses -->
        <div class="bg-[var(--color-card)] rounded-xl p-4 shadow flex flex-col justify-center h-full">
            <h2 class="text-3xl font-bold text-[var(--color-green-secondary)] mb-4 text-center">G√©rer les d√©penses</h2>
            <div class="grid grid-cols-3 gap-4 place-items-center">
                <button (click)="openDepenseModal()" class="btn flex items-center justify-center space-x-2 p-8 group w-full">
                    <img src="icons/add/add-normal.png" class="h-10 w-10 group-hover:hidden">
                    <img src="icons/add/add-hover.png" class="h-10 w-10 hidden group-hover:block">
                    <span>Ajouter</span>
                </button>
                <button (click)="openSelectDeleteDepenseModal()" class="btn flex items-center justify-center space-x-2 p-8 group w-full">
                    <img src="icons/cancel/cancel-normal.png" class="h-10 w-10 group-hover:hidden">
                    <img src="icons/cancel/cancel-hover.png" class="h-10 w-10 hidden group-hover:block">
                    <span>Supprimer</span>
                </button>
                <button (click)="openSelectEditDepenseModal()" class="btn flex items-center justify-center space-x-2 p-8 group w-full">
                    <img src="icons/edit/edit-normal.png" class="h-10 w-10 group-hover:hidden">
                    <img src="icons/edit/edit-hover.png" class="h-10 w-10 hidden group-hover:block">
                    <span>Modifier</span>
                </button>
                <button class="btn flex items-center justify-center space-x-2 p-8 col-1 col-span-2 group w-full">
                    <img src="icons/pay/pay-normal.png" class="h-10 w-10 group-hover:hidden">
                    <img src="icons/pay/pay-hover.png" class="h-10 w-10 hidden group-hover:block">
                    <span>Payer</span>
                </button>
                <button class="btn flex items-center justify-center space-x-2 p-8 col-3 group w-full">
                    <img src="icons/restart/restart-normal.png" class="h-10 w-10 group-hover:hidden">
                    <img src="icons/restart/restart-hover.png" class="h-10 w-10 hidden group-hover:block">
                    <span>Relancer</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add d√©pense modale -->
    <div *ngIf="isDepenseModalOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeDepenseModal()">
        <div class="bg-[var(--color-card)] p-6 rounded-xl shadow-lg relative w-full max-w-4xl" (click)="$event.stopPropagation()">
            <h2 class="text-[var(--color-green-secondary)] text-center text-2xl font-bold mb-6">Ajouter une d√©pense</h2>
        
            <form (ngSubmit)="submitDepense()" #depenseForm="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Titre -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Titre</label>
                    <input name="title" [(ngModel)]="depensesToSubmit.title" class="w-full p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
                  
            
                <!-- Montant -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Montant en ‚Ç¨</label>
                    <input type="number" name="amount" [(ngModel)]="depensesToSubmit.amount" class="w-full p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
            
                <!-- Cat√©gorie -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Cat√©gorie</label>
                    <select name="category" [(ngModel)]="depensesToSubmit.category" class="w-full p-2 rounded-xl bg-white border-3 border-[var(--color-green-secondary)] focus:border-none" required>
                        <option value="food">Alimentation</option>
                        <option value="transport">Transport</option>
                        <option value="entertainment">Loisirs</option>
                        <option value="bills">Factures</option>
                    </select>
                </div>                  
            
                <!-- Date de paiement-->
                <div>
                    <label for="paymentDate" class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Date de paiement</label>
                    <input type="date" id="paymentDate" name="paymentDate" [(ngModel)]="depensesToSubmit.paymentDate" class="w-full p-2 rounded-xl bg-white text-black border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
                
                <!-- Payer par -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Payer par</label>
                    <select name="payer" [(ngModel)]="depensesToSubmit.payer" class="w-full p-2 rounded-xl bg-white text-black border-3 border-[var(--color-green-secondary)] focus:border-none" required>
                        <option *ngFor="let name of participantNames" [value]="name">{{ name }}</option>
                    </select>
                </div>                  
    
                <!-- R√©partition -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">R√©partir avec</label>
                    <div class="space-y-2">
                      <div *ngFor="let name of participantNames" class="flex items-center space-x-4">
                        <label class="flex items-center space-x-3 cursor-pointer">
                          <input 
                            type="checkbox" 
                            [(ngModel)]="participants[name]" 
                            [name]="name" 
                            class="hidden peer"
                          />
                          <div class="w-7 h-7 rounded-lg border-4 border-[var(--color-green-secondary)] peer-checked:bg-[var(--color-green-primary)] transition"></div>
                          <span class="text-lg text-[var(--color-green-secondary)] capitalize">{{ name }}</span>
                        </label>
                      </div>
                    </div>
                </div> 
                <div class="flex mt-6 gap-4 justify-start">
                    <button type="button" (click)="closeDepenseModal()" class="btn flex items-center space-x-2 p-5 group">
                        <img src="icons/cancel/cancel-normal.png" class="h-10 w-10 group-hover:hidden">
                        <img src="icons/cancel/cancel-hover.png" class="h-10 w-10 hidden group-hover:block">
                        <span>Annuler</span>
                    </button>
                </div>      
                <div class="flex mt-6 gap-4 justify-end">
                    <button type="submit" class="btn flex items-center space-x-2 p-5 group">
                        <img src="icons/add/add-normal.png" class="h-10 w-10 group-hover:hidden">
                        <img src="icons/add/add-hover.png" class="h-10 w-10 hidden group-hover:block">
                        <span>Ajouter</span>
                    </button>
                </div>        
            </form>
        </div>
    </div>

    <!-- Select edit d√©pense modale -->
    <div *ngIf="isSelectDeleteDepenseModalOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeSelectDeleteDepenseModal()">
        <div class="bg-[var(--color-card)] p-6 rounded-xl shadow-lg relative w-full max-w-4xl" (click)="$event.stopPropagation()">
            <h2 class="text-[var(--color-green-secondary)] text-center text-2xl font-bold mb-6">S√©lectionner une d√©pense √† √©diter</h2>
        
            <ng-container *ngIf="depenses.length > 0; else noDepenses">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto max-h-[400px]">
                    <ng-container *ngFor="let depense of depenses">
                        <ng-container *ngIf="depense.status === '√† payer'">
                            <div (click)="submitDeleteDepense(depense)" class="text-white text-lg bg-[var(--color-green-secondary)] p-4 rounded-xl shadow-lg cursor-pointer hover:text-[var(--color-green-secondary)] hover:bg-[var(--color-green-highlight)] transition">
                                <h3 class="text-2xl font-bold">{{ depense.title }}</h3>
                                <p>Montant: {{ depense.amount | number:'1.2-2' }} ‚Ç¨</p>
                                <p>Payer par: {{ depense.paid_by }}</p>
                                <p>Date: {{ depense.paymentDate }}</p>
                                <p>Cat√©gorie: {{ depense.category }}</p>
                                <p>R√©partition: {{ getSharedUsernames(depense) }}</p>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
        </div>
    </div>

    <!-- Edit d√©pense modale -->
    <div *ngIf="isEditDepenseModalOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeEditDepenseModal()">
        <div class="bg-[var(--color-card)] p-6 rounded-xl shadow-lg relative w-full max-w-4xl" (click)="$event.stopPropagation()">
            <h2 class="text-[var(--color-green-secondary)] text-center text-2xl font-bold mb-6">Ajouter une d√©pense</h2>
        
            <form (ngSubmit)="submitEditDepense()" #depenseForm="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Titre -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Titre</label>
                    <input name="title" [(ngModel)]="depensesToSubmit.title" class="w-full p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
                  
            
                <!-- Montant -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Montant en ‚Ç¨</label>
                    <input type="number" name="amount" [(ngModel)]="depensesToSubmit.amount" class="w-full p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
            
                <!-- Cat√©gorie -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Cat√©gorie</label>
                    <select name="category" [(ngModel)]="depensesToSubmit.category" class="w-full p-2 rounded-xl bg-white border-3 border-[var(--color-green-secondary)] focus:border-none" required>
                        <option value="Alimentation">Alimentation</option>
                        <option value="transport">Transport</option>
                        <option value="entertainment">Loisirs</option>
                        <option value="bills">Factures</option>
                    </select>
                </div>                  
            
                <!-- Date de paiement-->
                <div>
                    <label for="paymentDate" class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Date de paiement</label>
                    <input type="date" id="paymentDate" name="paymentDate" [(ngModel)]="depensesToSubmit.paymentDate" class="w-full p-2 rounded-xl bg-white text-black border-3 border-[var(--color-green-secondary)] focus:border-none" required />
                </div>
                
                <!-- Payer par -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">Payer par</label>
                    <select name="payer" [(ngModel)]="depensesToSubmit.payer" class="w-full p-2 rounded-xl bg-white text-black border-3 border-[var(--color-green-secondary)] focus:border-none" required>
                        <option *ngFor="let name of participantNames" [value]="name">{{ name }}</option>
                    </select>
                </div>                  
    
                <!-- R√©partition -->
                <div>
                    <label class="block text-xl font-bold mb-2 text-[var(--color-green-secondary)]">R√©partir avec</label>
                    <div class="space-y-2">
                      <div *ngFor="let name of participantNames" class="flex items-center space-x-4">
                        <label class="flex items-center space-x-3 cursor-pointer">
                          <input 
                            type="checkbox" 
                            [(ngModel)]="participants[name]" 
                            [name]="name" 
                            class="hidden peer"
                          />
                          <div class="w-7 h-7 rounded-lg border-4 border-[var(--color-green-secondary)] peer-checked:bg-[var(--color-green-primary)] transition"></div>
                          <span class="text-lg text-[var(--color-green-secondary)] capitalize">{{ name }}</span>
                        </label>
                      </div>
                    </div>
                </div> 
                <div class="flex mt-6 gap-4 justify-start">
                    <button type="button" (click)="closeEditDepenseModal()" class="btn flex items-center space-x-2 p-5 group">
                        <img src="icons/cancel/cancel-normal.png" class="h-10 w-10 group-hover:hidden">
                        <img src="icons/cancel/cancel-hover.png" class="h-10 w-10 hidden group-hover:block">
                        <span>Annuler</span>
                    </button>
                </div>      
                <div class="flex mt-6 gap-4 justify-end">
                    <button type="submit" class="btn flex items-center space-x-2 p-5 group">
                        <img src="icons/confirm/confirm-normal.png" class="h-10 w-10 group-hover:hidden">
                        <img src="icons/confirm/confirm-hover.png" class="h-10 w-10 hidden group-hover:block">
                        <span>Confirmer</span>
                    </button>
                </div>        
            </form>
        </div>
    </div>

    <!-- Select edit d√©pense modale -->
    <div *ngIf="isDeleteDepenseModalOpen" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeSelectEditDepenseModal()">
        <div class="bg-[var(--color-card)] p-6 rounded-xl shadow-lg relative w-full max-w-4xl" (click)="$event.stopPropagation()">
            <h2 class="text-[var(--color-green-secondary)] text-center text-2xl font-bold mb-6">S√©lectionner une d√©pense √† √©diter</h2>
        
            <ng-container *ngIf="depenses.length > 0; else noDepenses">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto max-h-[400px]">
                    <ng-container *ngFor="let depense of depenses">
                        <ng-container *ngIf="depense.status === '√† payer'">
                            <div (click)="selectEditDepense(depense)" class="text-white text-lg bg-[var(--color-green-secondary)] p-4 rounded-xl shadow-lg cursor-pointer hover:text-[var(--color-green-secondary)] hover:bg-[var(--color-green-highlight)] transition">
                                <h3 class="text-2xl font-bold">{{ depense.title }}</h3>
                                <p>Montant: {{ depense.amount | number:'1.2-2' }} ‚Ç¨</p>
                                <p>Payer par: {{ depense.paid_by }}</p>
                                <p>Date: {{ depense.paymentDate }}</p>
                                <p>Cat√©gorie: {{ depense.category }}</p>
                                <p>R√©partition: {{ getSharedUsernames(depense) }}</p>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>
        </div>
    </div>

    <!-- Historique des d√©penses -->
    <div class="bg-[var(--color-card)] rounded-xl p-6 shadow flex flex-col col-span-2">
        <h2 class="text-3xl font-bold text-[var(--color-green-secondary)] mb-6 text-center">Historique des d√©penses</h2>

        <!-- Filtres -->
        <div class="flex flex-wrap gap-4 mb-4 justify-end">
            <input type="text" placeholder="Filtrer par personne" class="p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none w-48" />
            <input type="date" class="p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none w-48" />
            <input type="text" placeholder="Filtrer par titre" class="p-2 rounded-xl border-3 border-[var(--color-green-secondary)] focus:border-none w-48" />
        </div>

        <!-- Table -->
        <div class="overflow-x-auto max-h-[400px] overflow-y-auto">
            <table class="min-w-full text-left table-auto">
                <thead class="sticky top-0 text-white bg-[var(--color-green-secondary)] z-10">
                    <tr>
                        <th class="p-2 font-bold border-r-2 border-[var(--color-card)]">Titre</th>
                        <th class="p-2 font-bold border-r-2">Prix (‚Ç¨)</th>
                        <th class="p-2 font-bold border-r-2 border-[var(--color-card)]">Personne</th>
                        <th class="p-2 font-bold border-[var(--color-card)]">Date</th>
                    </tr>
                </thead>
                <tbody class="font-bold text-[var(--color-green-secondary)]">
                    <ng-container *ngIf="depenses.length > 0; else noDepenses">
                        <ng-container *ngFor="let depense of depenses">
                            <tr class="border-b-2 border-[var(--color-green-secondary)] hover:bg-[var(--color-green-highlight)]">
                                <td class="p-2">{{depense.title}}</td>
                                <td class="p-2">{{depense.amount | number:'1.2-2'}}</td>
                                <td class="p-2">{{depense.paid_by}}</td>
                                <td class="p-2">{{depense.paymentDate}}</td>
                            </tr>
                        </ng-container>
                    </ng-container>
                    <ng-template #noDepenses>
                        <td colspan="4" class="text-center p-4">Aucune d√©pense enregistr√©e</td>
                    </ng-template>
                </tbody>
            </table>
        </div>
    </div>
</div>